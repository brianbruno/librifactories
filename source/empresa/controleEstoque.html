<script>
    function trocarParaDivAdd() {
        document.getElementById("subs").innerHTML = '<div style="background-color: rgba(250,250,250,.6); color: black;" id="novaDiv"><h1>Adicionar ao Estoque</h1><div class="row"><div class="col s12">  <div class="input-field inline"><input id="nomeP" type="text"><label for="email" data-error="wrong" data-success="right">Nome</label></div></div></div><div class="row"><div class="col s12"><div class="input-field inline"><input id="quantP" type="text"><label for="email" data-error="wrong" data-success="right">Quantidade</label></div></div></div><a onclick="adicionarProduto();" style="cursor: pointer;" id="selo" class="waves-light btn">Adicionar</a></div>';
    }

    function trocarParaDivDel() {
        document.getElementById("subs").innerHTML = '<div style="background-color: rgba(250,250,250,.6); color: black;" id="novaDiv"><h1>Deletar do Estoque</h1><div class="row"><div class="col s12">  <div class="input-field inline"><input id="nomeDel" type="text"><label for="nomeDel" data-error="wrong" data-success="right">Nome</label></div></div></div><div class="row"><div class="col s12"><div class="input-field inline"><input id="quantDel" type="text"><label for="quantDel" data-error="wrong" data-success="right">Quantidade</label></div></div></div><a onclick="deletarProduto();" style="cursor: pointer;" id="selo" class="waves-light btn">Deletar</a></div>';
    }

    function atualizarEstoque() {
        $.ajax({
            url: 'http://127.0.0.1:880?operacao=atualizarEstoque',
            success: function(result) {
                console.log(result);

                if (result.length != 0) {
                    document.getElementById("productEstoque").innerHTML = '';
                    for (var i = 0; i < result.length; i++) {
                        var nome = result[i].nome;
                        var quant = result[i].quantidade;
                        var de = 29
                        var aleatorio = 121+de;
                        
                            checarMateriaPrima(result[i].nome, function(result2) {
                                    if (result2.emEstoque)
                                        cor = "green";
                                    else {
                                        cor = "red";                                        
                                    }
                            });
                        var caminhoImagem = "url('imagens/Materias/" + result[i].nome + ".jpg')";

                        document.getElementById("productEstoque").innerHTML += '<div onclick="atualizarPainel(' + i + ');" class="produtoEstocado"><div class="divQuant"><button id="quantP'+i+'" class="btnQuant">' + result[i].quantidade + '</button></div><div id="' + i + '" class="imagemMateria" style="background-image: ' + caminhoImagem + '; border-radius: 10px;"></div><h1 id="nomeP' + i + '">' + result[i].nome + '</h1></div>';
                    }
                }
            }
        });
        if($("#valorCirculoQuant").text() == 0) $("#circuloQuant").fadeTo(2,0); 
    }

    function atualizarPainel(i) {
        var nomeP = "nomeP" + i;
        var quantP = "quantP" + i;

        var nome = $("#" + nomeP).text();
        var quant = $("#" + quantP).text();

        var cor;
        var possui = checarMateriaPrima(nome, function(result) {
            if (result.emEstoque)
                cor = "green";
            else {
                cor = "red";
            }

            $("#subs").html('<div id="novaDiv"><h1>Materia Prima</h1>Nome: <h5>' + nome + '</h5>Quantidade: <h5>' + quant + '</h5><a id="selo" class="waves-light btn ' + cor + '"></a></div>');
        });
    }

    function checarMateriaPrima(nome, callback) {
        $.ajax({
            url: "http://127.0.0.1:880?operacao=checarMateriaPrima&usuario=" + getCookie('usuariologado') + "&senha=" + getCookie('senha') + "&nome=" + nome,
            success: callback
        });
    }

    function adicionarProduto() {
        var nome = $("#nomeP").val();
        var quant = $("#quantP").val();

        if (nome != "" && quant != "") {
            $.ajax({
                url: 'http://127.0.0.1:880?nome=' + nome + '&quantidade=' + quant + '&operacao=addProdutosEstoque',
                success: function(result) {

                }
            });

        }

        setTimeout(atualizarEstoque(), 500);
        setTimeout(atualizarEstoque(), 500);

    }

    function deletarProduto() {
        var nome = $("#nomeDel").val();
        var quant = $("#quantDel").val();

        if (nome != "" && quant != "") {
            $.ajax({
                url: 'http://127.0.0.1:880?nome=' + nome + '&quantidade=' + quant + '&operacao=delProdutosEstoque',
                success: function(result) {

                }
            });

        }

        setTimeout(atualizarEstoque(), 500);
        setTimeout(atualizarEstoque(), 500);

    }


    $(document).ready(function() {
        $('.collapsible').collapsible();
        atualizarEstoque();
    });

    function mudarImgParaQuant() {
        $('.imagemDoProduto').toggle(500);
        $('.quantProduto').toggle(500);
    }

    function mudarQuantParaImg() {
        $('.quantProduto').toggle(500);
        $('.imagemDoProduto').toggle(500);
    }


    function carregarCategoria(quant, min, max) {
        var quantidade = quant;
        document.getElementById('quant').innerHTML = quantidade + '<br><span class="uni">unidades</span>';
        if (quant < min) {
            $("#product").addClass("quantAbaixo");
        } else if (quant > max) {
            $("#product").addClass("quantAcima");
        } else if (quant > min && quant < max) {
            $("#product").addClass("quantNormal");
        }
    }

    function alternarNotificacoesProdutos() {
        $(".btnQuant").toggle();
        $("#notificacoes").slideToggle(500);
        $("#productEstoque").slideToggle(500);
        $("#relatorio").slideToggle(500);
        $("#informativa").slideToggle(500);
    }

</script>
<section>
    <div id="informativa" class="informativa">
        MATERIAS PRIMAS
    </div>

    <div id="relatorio" class="informativa">
        RELATÓRIO DE PRODUTOS COM ALERTA
    </div>

    <div id="circuloQuant">
        <a id="valorCirculoQuant" onclick="alternarNotificacoesProdutos();" data-position="top" class="tooltipped btn btn-floating btn-large pulse" data-position="top" data-tooltip="Alerta de Excesso/Escassez" data-delay="50">2</a>
    </div>


    <div id="notificacoes">
        <ul id="relatorio2" class="collapsible popout" data-collapsible="accordion">
            <li><div class="collapsible-header">EVA</div><div class="collapsible-body"><span>Contém 2 <br>Necessita de: 43 unidades.</span></div></li>
             <li><div class="collapsible-header">Tampa de encaixe</div><div class="collapsible-body"><span>Contém 35<br>Necessita de: 29 unidades.</span></div></li>
        </ul>

    </div>

    <div id="productEstoque">

    </div>
</section>

<!---->

<div id="subs">
    <div id="novaDiv">
        Bem vindo ao controle de estoque da LIBRI FACTORIES, para visualizar uma materia prima, clique sobre a materia
    </div>
</div>

<div class="fixed-action-btn horizontal">
    <a class="btn-floating btn-large red">
        <i class="large material-icons">mode_edit</i>
    </a>
    <ul>
        <li><a onclick="trocarParaDivDel();" class="btn-floating red"><i class="material-icons">delete_forever</i></a></li>
        <li><a onclick="trocarParaDivAdd();" class="btn-floating blue"><i class="material-icons">add_box</i></a></li>
    </ul>
</div>

<style>
    @import url('https://fonts.googleapis.com/css?family=Crimson+Text');
    @import url('https://fonts.googleapis.com/css?family=Rubik');
    div.imagemMateria {
        position: relative;
        width: 100%;
        height: 100px;
        background-size: cover;
        overflow: hidden;
    }
    
    div.divQuant {}
    
    div button.btnQuant {
        color: white;
        width: 45px;
        position: relative;
        height: 45px;
        border-radius: 100%;
        margin-top: -18px;
        margin-left: -12px;
        position: absolute;
        border: none;
        cursor: pointer;
        background-color: rgba(57, 68, 73, .9);
        box-shadow: 1px 2px 1px 1px rgba(0, 0, 0, .1);
        z-index: 1;
    }
    
    div#novaDiv h1 {
        font-size: 30px;
        margin-top: 0;
        text-align: center;
        font-family: 'Crimson Text', serif;
        margin-bottom: 20px;
    }
    
    div#novaDiv h5 {
        font-size: 30px;
        margin-top: 0;
        font-family: 'Rubik', sans-serif;
        margin-bottom: 10px;
    }
    
    div#novaDiv a {
        float: right;
        cursor: auto;
        margin-bottom: 0;
    }
    
    div#novaDiv {
        width: 20%;
        box-shadow: 1px 1px 10px 1px rgba(0, 0, 0, .5);
        padding: 15px;
        right: 70px;
        border-radius: 5px;
        color: white;
        background-color: rgba(38, 50, 56, .9);
        position: fixed;
    }
    
    .produtoEstocado {
        background-color: rgba(255, 255, 255, .5);
        width: 20%;
        height: auto;
        margin: 1%;
        margin-top: 20px;
        border-radius: 10px;
        box-shadow: 1px 2px 1px 1px rgba(0, 0, 0, .3);
        display: inline-table;
        cursor: pointer;
        border-top: 1px dashed rgba(38, 50, 56, .9);
        border-left: 1px dashed rgba(38, 50, 56, .9);
    }
    
    #productEstoque h1 {
        margin-top: 10px;
        padding-top: 20px;
        font-size: 20px;
        text-align: center;
    }
    /*Navbar*/
    
    div.nav-wrapper {
        background-color: #263238;
    }
    /*Resultado da pesquisa no estoque*/
    
    section {
        padding: 10px;
        width: 64%;
        margin-left: 100px;
        border-radius: 19px;
        background-color: rgba(255, 255, 255, .6);
        position: absolute;
        box-shadow: 1px 2px 1px 3px rgba(0, 0, 0, .3);
    }
    
    div.informativa {
        padding: 0;
        background-color: #263238;
        border-top-left-radius: 19px;
        border-top-right-radius: 19px;
        color: white;
        font-size: 20px;
        text-align: center;
        margin-bottom: -25px;
    }
    
    div#circuloQuant a {
        top: -20px;
        left: -60px;
        color: white;
        font-size: 30px;
        font-family: century gothic;
    }
    
    section a.products {
        margin-bottom: 15px;
        width: 100%;
    }
    /* NOTIFICACOES x PRODUTOS*/
    
    div#notificacoes {
        display: none;
    }
    
    div#productEstoque {
        display: block;
    }
    
    div#informativa {
        display: block;
    }
    
    div#relatorio {
        display: none;
    }
