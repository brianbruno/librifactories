<div class="col s12" div="filtros">
    <div id="divEsquerda">
        <span class="fl">
            <input name="group1" type="radio" id="test1" checked />
            <label for="test1">Todos os pedidos</label>
        </span>
        <span class="fl">
            <input name="group1" type="radio" id="test2" />
            <label for="test2">Pedidos aprovados</label>
        </span>
        <span class="fl">
            <input name="group1" type="radio" id="test3" />
            <label for="test3">Pedidos rejeitados</label>
        </span>
    </div>
    <div class="input-field select" id="divFiltrarPor">
        <select class="validate">
            <option value="" disabled selected>Filtrar por: </option>
            <option value="1">Data</option>
            <option value="2">Preço</option>
            <option value="3">Situação</option>
        </select>
    </div>
</div>
<hr>
<table class="responsive-table centered highlight">
    <thead>
        <tr>
            <th>Cod.</th>
            <th>Data do pedido</th>
            <th>Custo de producao</th>
            <th>Lucro esperado</th>
            <th></th>
        </tr>
    </thead>

    <tbody id="body-table"></tbody>
</table>
<script>
    var imagens = new Array();
    var descricoes = new Array();
    var precos = new Array();
    var materiaPrima = new Array();
    var tempoEstimado = new Array();
    var itemClicado = -1;

    $(document).ready(function () {
        listarPedidos();
    });

    $('tbody').hide();

    function telaCarregada() {
        $('tbody').show(200);
    }

    function listarPedidos() {
        var bodyTable = document.getElementById("body-table");
        var html = "";
        requisicao("listarPedidos", function (result) {
            console.log(result);
            result.forEach(function (pedido, index) {
                html += "<tr>";
                html += "<td>" + pedido.id + "</td>";
                html += "<td>" + pedido.dataCompra + "</td>";
                html += "<td>R$3000,00</td>";
                html += "<td>R$500,00</td>";
                html += '<td><a class="waves-effect waves-light btn modal-trigger" href="#modalDetalhesPedido" onclick="mostrarModal(' + (index + 1) + ')">Mais detalhes</a></td>';
                html += "</tr>"
            });
            $("#body-table").html(html);
        });
    }

    function listarProdutos(numPedido) {
        var body = document.getElementById("itens-pedido");
        var html = "";
        requisicao("listarPedidos", function (result) {
            result.forEach(function (pedido, index) {
                if (index == numPedido) {
                    $("#idDoPedido").html(pedido.id);
                    html += '<h5 class="center" style="margin-bottom: 20px">Itens do Pedido</h5>';
                    pedido.produtos.forEach(function (produto, index) {
                        console.log(produto.produto.nome);
                        html += '<div id="p' + (index+1) + '" class="div-produto" onclick="selecionarProduto(' + (index+1) + ')"><span id="s' + (index+1) + '">' + produto.produto.nome + ' </span>' + produto.quantidade + '</div>';
                        if (!produto.finalizado) html += '<div id="dp' + (index+1) + '" class="detalhes-produto"><h6>Matéria-prima</h6>Item 1: Em estoque<br>Item 2: Em falta<h6>Tempo de Produção</h6>' + produto.produto.tempoMedio + ' dias<hr>Finalizado: <i id="check' + (index+1) + '" onclick="checar(' + (index+1) + ')" class="check material-icons" style="vertical-align: bottom">radio_button_unchecked</i></div>';
                        else html += '<div id="dp' + (index+1) + '" class="detalhes-produto"><h6>Matéria-prima</h6>Item 1: Em estoque<br>Item 2: Em falta<h6>Tempo de Produção</h6>' + produto.produto.tempoMedio + ' dias<hr>Finalizado: <i id="check' + (index+1) + '" onclick="checar(' + (index+1) + ')" class="check material-icons selecionado" style="vertical-align: bottom">check_circle</i></div>';
                        console.log($("#check" + (index+1)).html())
                        console.log(produto.finalizado);
                        console.log(html);
                    });
                    $("#itens-pedido").html(html);
                }
            });
        });
    }

    function requisicao(query, callback) {
        $.ajax({
            url: "http://127.0.0.1:880/?usuario=" + getCookie("usuariologado") + "&senha=" + getCookie("senha") + "&operacao=" + query,
            success: callback
        });
    }

    function precoTotal(i) {
        var total = 0.0;
        for (let a = 1; a <= 6; a++)
            total += precos[i, a] * 5;
        return total;
    }

    function mostrarModal(i) {
        listarProdutos(i-1);
    }

    function selecionarProduto(i) {
        $("#p" + i).toggleClass("selecionado");
        if ($("#p" + i).hasClass("selecionado")) {
            desselecionarProdutos(i);
            $("#dp" + i).show(200);
        } else {
            $("#dp" + i).hide(200);
        }
    }

    function desselecionarProdutos(i) {
        for (var a = 1; $("#dp" + a).length; a++) {
            if (a != i) {
                $("#dp" + a).hide(200);
                $("#p" + a).removeClass("selecionado");
            }
        }
    }

    function checar(i) {
        if ($("#check" + i).html() != "check_circle") {
            $("#check" + i).html("check_circle");
            produtoFinalizado($("#s" + i).html());
            $("#check" + i).addClass("selecionado");
        }
    }

    function produtoFinalizado(nome) {
        $.ajax({
            url: "http://localhost:880/?operacao=produtoFinalizado&usuario=" + getCookie("usuariologado") + "&senha=" + getCookie("senha") + "&nome=" + nome + "&id=" + $('#idDoPedido').html().substring(1),
            success: function(response) {
                console.log("OIOI");
                console.log(response);
            }
        });
    }

</script>
<style>
    .input-field.select {
        display: inline-block;
        width: 150px;
        margin-bottom: -20px;
    }

    .clearFull {
        display: block;
        clear: both;
    }

    #itens-pedido {
        display: inline-block;
        width: 45%;
        vertical-align: top;
    }

    #detalhes-pedido {
        display: inline-block;
        width: 45%;
        vertical-align: top;
        float: right;
    }

    .div-produto {
        padding: 10px;
        box-shadow: 0px 0px 1px 0px rgba(0, 0, 0, 1);
        width: 90%;
        margin-left: 5%;
        margin-top: 2px;
        transition: 0.5s;
    }

    .div-produto>span {
        font-size: 120%;
    }

    .div-produto.selecionado>span {
        font-weight: bold;
    }

    .div-produto:hover {
        box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, .6);
        cursor: pointer;
        width: 100%;
        margin-left: 0;
    }

    .div-produto.selecionado {
        box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, .6);
        cursor: pointer;
        width: 100%;
        margin-left: 0;
    }

    .detalhes-produto {
        display: none;
        width: 90%;
        margin-top: 1px;
        margin-bottom: 7px;
        margin-left: 10%;
        padding: 7px;
        box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, .6);
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
        vertical-align: top;
    }

    .detalhes-produto>h6 {
        font-size: 100%;
        font-weight: bold;
    }

    .check {
        color: black;
    }

    .check.selecionado {
        color: #32cd32;
    }

    .check:hover {
        cursor: default;
    }

    /*  */
</style>